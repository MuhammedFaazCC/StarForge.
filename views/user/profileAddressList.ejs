<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Addresses - StarForge</title>
  <link rel="stylesheet" href="/css/user/profileDashboard.css" />
  <link rel="stylesheet" href="/css/user/navbar-badges.css">
  <link rel="stylesheet" href="/css/user/profileAddressList.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11.7.32/dist/sweetalert2.min.css" rel="stylesheet">
</head>

<body>
  <%- include('../partials/user/navbar', { minimalNavbar: false }) %>
    <button class="sidebar-toggle1 d-md-none" id="sidebarToggle1" aria-label="Toggle Sidebar">
      <i class="fas fa-chevron-right" id="sidebarToggleIcon1"></i>
    </button>
    <%- include('../partials/user/profileSidebar', { user, currentPage: 'address' }) %>

      <div class="main-content">
        <div class="content-wrapper">
          <div class="profile-container">
            <div class="page-header">
              <div>
                <h1 class="page-title">My Addresses</h1>
                <div class="breadcrumb">
                  <a href="/LoadProfile">My Profile</a> / My Addresses
                </div>
              </div>
              <a href="/address/add" class="btn-primary add-address-btn">
                <i class="fas fa-plus"></i>
                Add New Address
              </a>
            </div>

            <% if (typeof error !=='undefined' && error) { %>
              <div class="alert alert-error" id="errorAlert">
                <i class="fas fa-exclamation-circle"></i>
                <span>
                  <%= error %>
                </span>
                <button type="button" class="alert-close" onclick="closeAlert('errorAlert')">
                  <i class="fas fa-times"></i>
                </button>
              </div>
              <% } %>

                <% if (typeof success !=='undefined' && success) { %>
                  <div class="alert alert-success" id="successAlert">
                    <i class="fas fa-check-circle"></i>
                    <span>
                      <%= success %>
                    </span>
                    <button type="button" class="alert-close" onclick="closeAlert('successAlert')">
                      <i class="fas fa-times"></i>
                    </button>
                  </div>
                  <% } %>

                    <% if (addresses.length> 0) { %>
                      <div class="address-stats">
                        <div class="stat-item">
                          <i class="fas fa-map-marker-alt"></i>
                          <span class="stat-number">
                            <%= addresses.length %>
                          </span>
                          <span class="stat-label">Total Addresses</span>
                        </div>
                        <div class="stat-item">
                          <i class="fas fa-star"></i>
                          <span class="stat-number">
                            <%= addresses.filter(addr=> addr.isDefault).length %>
                          </span>
                          <span class="stat-label">Default Address</span>
                        </div>
                      </div>
                      <% } %>

                        <% if (addresses.length===0) { %>
                          <div class="empty-state">
                            <div class="empty-icon">
                              <i class="fas fa-map-marker-alt"></i>
                            </div>
                            <div class="empty-title">No addresses found</div>
                            <div class="empty-description">
                              You haven't added any delivery addresses yet. Add your first address to get started with
                              seamless deliveries.
                            </div>
                            <a href="/address/add" class="btn-primary empty-action-btn">
                              <i class="fas fa-plus"></i>
                              Add Your First Address
                            </a>
                          </div>
                          <% } else { %>
                            <div class="addresses-container">
                              <div class="addresses-grid">
                                <% addresses.forEach((address, index)=> { %>
                                  <div class="address-card <%= address.isDefault ? 'default-address' : '' %>"
                                    data-address-id="<%= address._id %>">
                                    <div class="address-header">
                                      <div class="address-name">
                                        <i class="fas fa-user"></i>
                                        <span class="name-text">
                                          <%= address.name %>
                                        </span>
                                        <% if (address.isDefault) { %>
                                          <span class="default-badge">
                                            <i class="fas fa-star"></i>
                                            Default
                                          </span>
                                          <% } %>
                                      </div>
                                      <div class="address-actions">
                                        <button class="action-btn edit-btn"
                                          onclick="openEditModal(event, '<%= address._id %>')" title="Edit Address"
                                          aria-label="Edit Address">
                                          <i class="fas fa-edit"></i>
                                        </button>
                                        <% if (!address.isDefault) { %>
                                          <button class="action-btn default-btn"
                                            onclick="setDefaultAddress(event, '<%= address._id %>')"
                                            title="Set as Default" aria-label="Set as Default">
                                            <i class="fas fa-star"></i>
                                          </button>
                                          <% } %>
                                            <button class="action-btn delete-btn"
                                              onclick="deleteAddress(event, '<%= address._id %>')"
                                              title="Delete Address" aria-label="Delete Address">
                                              <i class="fas fa-trash"></i>
                                            </button>
                                      </div>
                                    </div>

                                    <div class="address-details">
                                      <% if (address.mobile) { %>
                                        <div class="address-field">
                                          <i class="fas fa-phone"></i>
                                          <span>
                                            <%= address.mobile %>
                                          </span>
                                        </div>
                                        <% } %>

                                          <div class="address-field">
                                            <i class="fas fa-map-marker-alt"></i>
                                            <span class="address-text">
                                              <%= address.address %><br>
                                                <%= address.city %>, <%= address.district %><br>
                                                    <%= address.state %> - <%= address.pinCode %>
                                            </span>
                                          </div>
                                    </div>

                                    <div class="address-footer">
                                      <button class="quick-action-btn" onclick="copyAddress('<%= address._id %>')"
                                        title="Copy Address">
                                        <i class="fas fa-copy"></i>
                                        Copy
                                      </button>
                                      <% if (!address.isDefault) { %>
                                        <button class="quick-action-btn"
                                          onclick="setDefaultAddress(event, '<%= address._id %>')"
                                          title="Set as Default">
                                          <i class="fas fa-star"></i>
                                          Set Default
                                        </button>
                                        <% } %>
                                    </div>
                                  </div>
                                  <% }) %>
                              </div>
                            </div>
                            <% } %>
          </div>
        </div>
      </div>

      <div class="modal fade" id="editAddressModal" tabindex="-1" aria-labelledby="editAddressModalLabel"
        aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="editAddressModalLabel">
                <i class="fas fa-edit"></i>
                Edit Address
              </h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <form id="editAddressForm" novalidate>
                <input type="hidden" id="editAddressId" name="addressId">

                <div class="row">
                  <div class="col-md-6 mb-3">
                    <label for="editName" class="form-label">
                      <i class="fas fa-user"></i>
                      Full Name *
                    </label>
                    <input type="text" class="form-control" id="editName" name="name" required>
                    <div class="invalid-feedback"></div>
                  </div>
                  <div class="col-md-6 mb-3">
                    <label for="editMobile" class="form-label">
                      <i class="fas fa-phone"></i>
                      Mobile Number
                    </label>
                    <input type="tel" class="form-control" id="editMobile" name="mobile" pattern="[0-9]{10}"
                      maxlength="10">
                    <div class="invalid-feedback"></div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="editAddress" class="form-label">
                    <i class="fas fa-home"></i>
                    Address (House No, Building, Street, Area) *
                  </label>
                  <textarea class="form-control" id="editAddress" name="address" rows="3" required></textarea>
                  <div class="invalid-feedback"></div>
                </div>

                <div class="row">
                  <div class="col-md-4 mb-3">
                    <label for="editPincode" class="form-label">
                      <i class="fas fa-map-pin"></i>
                      Pincode *
                    </label>
                    <input type="text" class="form-control" id="editPincode" name="pincode" pattern="[0-9]{6}"
                      maxlength="6" required>
                    <div class="invalid-feedback"></div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="editCity" class="form-label">
                      <i class="fas fa-city"></i>
                      City *
                    </label>
                    <input type="text" class="form-control" id="editCity" name="city" required>
                    <div class="invalid-feedback"></div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <label for="editDistrict" class="form-label">
                      <i class="fas fa-map"></i>
                      District *
                    </label>
                    <input type="text" class="form-control" id="editDistrict" name="district" required>
                    <div class="invalid-feedback"></div>
                  </div>
                </div>

                <div class="mb-3">
                  <label for="editState" class="form-label">
                    <i class="fas fa-flag"></i>
                    State *
                  </label>
                  <input type="text" class="form-control" id="editState" name="state" required>
                  <div class="invalid-feedback"></div>
                </div>

                <div class="mb-3 form-check">
                  <input type="checkbox" class="form-check-input" id="editIsDefault" name="isDefault">
                  <label class="form-check-label" for="editIsDefault">
                    <i class="fas fa-star"></i>
                    Make this my default address
                  </label>
                </div>
              </form>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                <i class="fas fa-times"></i>
                Cancel
              </button>
              <button type="button" class="btn btn-primary" id="updateAddressBtn">
                <i class="fas fa-save"></i>
                Update Address
              </button>
            </div>
          </div>
        </div>
      </div>

      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
      <script src="/js/user/landingPage.js"></script>
      <script src="/js/user/profileAddressList.js"></script>

</body>

</html>